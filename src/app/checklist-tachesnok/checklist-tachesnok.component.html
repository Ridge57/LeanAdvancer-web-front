
<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <app-side-navigation></app-side-navigation>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content ">

            <!-- Topbar -->
            <app-top-navigation></app-top-navigation>
            <!-- End of Topbar -->
            <div class="container-fluid">
                <!-- Page Heading -->
                <div class="mb-4">
                  <h3 class="h3 mb-0 text-gray-800">Gestion des checklists | <small>tâches nok à traiter</small></h3>
              </div>
                <app-checklist-tabmenu></app-checklist-tabmenu>
 
                  <p-table [columns]="cols" [value]="taches" selectionMode="single" class="mb-4 card shadow" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
                  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" class="text-center">
                      <ng-template pTemplate="header" let-columns>
                          <tr>
                              <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                                <i *ngIf="col.header=='Titre de la tâche'" class="fas fa-bullseye" style="color: #4e73df;"></i>       
                                <i *ngIf="col.header=='Date'" class="fas fa-clock" style="color: #36b9cc;"></i> 
                                <i *ngIf="col.header=='Status'" class="fas fa-clipboard-check" style="color:#1cc88a;"></i>
                                  {{col.header}}
                                  <p-sortIcon [field]="col.field" *ngIf="col.header=='Titre de la tâche'" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon> 
                              </th>
                              <th>
                                <i class="fas fa-search" style="color: #36b9cc;"></i> 
                                 voir
                              </th>
                          </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-rowData let-columns="columns">
                          <tr [pSelectableRow]="rowData">
                              <td *ngFor="let col of columns">
                                  <div *ngIf="col.subfield;then nested_object_content else normal_content"></div>
                                  <ng-template #normal_content >
                                    {{rowData[col.field]}}
                                  </ng-template>
                                  <ng-template #nested_object_content >
                                    {{rowData[col.field][col.subfield] | date:'EEEE, d MMMM, y'}}
                                  </ng-template>
                              </td>
                              <td class="d-flex justify-content-around">
                                  <button  (click)=showTaskDetails(rowData) type="button" class="btn btn-info" data-toggle="modal" data-target="#ajoutModal" data-backdrop="static" data-keyboard="false">
                                      <i class="pi pi-search" style="font-size: 1.2em;"></i>
                                  </button>
                              </td>
                          </tr>
                      </ng-template>
                  </p-table>



            </div>
        </div>
    </div>
</div>
  
<!-- modal détails HistoriqTache -->
<div *ngIf="selectedTask" class="modal fade" id="ajoutModal" tabindex="-1" role="dialog" aria-labelledby="ajoutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header alert alert-primary" role="alert">
        <div class="text-center">
          <span class="mr-3">
            <i class="fas fa-map-marker-alt" style="color: #4e73df;"></i> {{selectedTask.historiqChecklist.zone.nomZone}}
          </span> 
          <span class="mr-3">
            <i class="fas fa-clock" style="color: #36b9cc;"></i> {{selectedTask.historiqChecklist.date | date:'EEEE, d MMMM, y'}}
          </span>
          <span class="mr-3">
            <i class="fas fa-user" style="color:#1cc88a;"></i> {{selectedTask.historiqChecklist.user.userName}}
          </span>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">         
          <div class="form-group container">
              <div>
                <ul class="list-group">
                  <li class="list-group-item">
                    <div class="col-sm-12 row">
                      <div class="col-sm-4 col">
                        <img  *ngIf='selectedTask.photo' src="{{selectedTask.photo}}" style="width: 80%;">
                        <img  *ngIf='!selectedTask.photo' alt="...">
                      </div>
                      <div class="col-sm-5 col text-muted" style="font-size: 15px;" >
                        <div>
                          <span class="font-weight-bolder">Activité à réaliser : </span><br/>
                          <p>{{selectedTask.titre}}</p>
                        </div>
                        
                        <div>
                          <span class="font-weight-bolder">Description : </span><br/>
                          <p>{{selectedTask.description}}</p>
                        </div>

                        <div>
                          <span class="font-weight-bolder">Résultat : </span>{{selectedTask.status}} <i class="fas fa-exclamation-circle" style="color:#C82333;font-size: 16px;"></i><br/>
                        </div>
                        <br/>
                        <div>
                          <span class="font-weight-bolder">Commentaires laissés : </span><br/>
                          <p>{{selectedTask.commentaires}}</p>
                        </div>

                      </div>
                      <div class="col-sm-3 col container">
                        <div class="row">
                          <div class="form-group">
                            <select (change)="setResolution($event.target.value)" class="form-control">
                              <option *ngFor="let status of statusTasks" value='{{status}}'>{{status}}</option>
                            </select>
                          </div>
                        </div>
                        <br/>
                        <br/>
                        <div class="row">
                          <div *ngIf="this.selectedTask.traitement===statusTasks[0]" class="alert alert-danger" role="alert">
                            A TRAITER
                          </div>
                          <div *ngIf="this.selectedTask.traitement===statusTasks[1]" class="alert alert-success" role="alert">
                            SOLDÉ
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
          </div>
      </div>
      <div class="modal-footer">
          <button *ngIf="displaySaveButton" (click)="saveChanges()" type="button" class="btn btn-success">Sauvegarder</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
      </div>
    </div>
  </div>
</div>