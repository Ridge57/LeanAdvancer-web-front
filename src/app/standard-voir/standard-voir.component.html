<!-- Page Wrapper -->
<div id="wrapper">

    <!-- Sidebar -->
    <app-side-navigation></app-side-navigation>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content ">

            <!-- Topbar -->
            <app-top-navigation></app-top-navigation>
            <!-- End of Topbar -->
            <div class="container-fluid col-sm-12 col-lg-10 mx-auto">
                <!-- Page Heading -->
                <div class="mb-4">
                    <h3 class="h3 mb-0 text-gray-800">Gestion des modes opératoires | <small>ajouter un mode
                            opératoire</small></h3>
                </div>
                <app-standard-tabmenu></app-standard-tabmenu>
                <p-toast [style]="{marginTop: '20px'}"></p-toast>

                <!-- Liste des standards -->
                <p-table [columns]="cols" [value]="standards" selectionMode="single" class="mb-4 card shadow"
                    [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
                    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" class="text-center">
                    <ng-template pTemplate="header" let-columns>
                        <tr>
                            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                                <i *ngIf="col.header=='Zone'" class="fas fa-map-marker-alt" style="color: #4e73df;"></i>
                                <i *ngIf="col.header=='Titre'" class="fas fa-bullseye" style="color: #4edf6e;"></i>
                                {{col.header}}
                                <p-sortIcon [field]="col.field" *ngIf="col.header=='Titre'" ariaLabel="Activate to sort"
                                    ariaLabelDesc="Activate to sort in descending order"
                                    ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                            </th>
                            <th>
                                <i class="fas fa-search" style="color: #36b9cc;"></i>
                                voir
                            </th>
                            <th>
                                <i class="fas fa-edit" style="color:#dfdb23;"></i>
                                modifier
                            </th>
                            <th>
                                <i class="fas fa-times-circle" style="color:#e2553d;"></i>
                                supprimer
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-rowData let-columns="columns">
                        <tr [pSelectableRow]="rowData" (click)="getSelectedStandard(rowData)">
                            <td *ngFor="let col of columns">
                                <div *ngIf="col.subfield;then nested_object_content else normal_content"></div>
                                <ng-template #normal_content>
                                    {{rowData[col.field]}}
                                </ng-template>
                                <ng-template #nested_object_content>
                                    {{rowData[col.field][col.subfield]}}
                                </ng-template>
                            </td>
                            <td>
                                <a class="btn btn-info" role="button" *ngIf="selectedStandardID==rowData.idStandard"
                                    (click)="afficherStandard(selectedStandardID)">
                                    <i class="fas fa-search" style="font-size: 1.2em;"></i>
                                </a>
                                <a class="btn btn-info" role="button" *ngIf="selectedStandardID!=rowData.idStandard"
                                    disabled>
                                    <i class="fas fa-search" style="font-size: 0.8em;"></i>
                                </a>
                            </td>
                            <td>
                                <a class="btn btn-warning" role="button" *ngIf="selectedStandardID==rowData.idStandard"
                                    [routerLink]="['/standardRectifier', selectedStandardID]">
                                    <i class="fas fa-edit" style="font-size: 1.2em;"></i>
                                </a>
                                <a class="btn btn-warning" role="button" *ngIf="selectedStandardID!=rowData.idStandard"
                                    disabled>
                                    <i class="fas fa-edit" style="font-size: 0.8em;"></i>
                                </a>
                            </td>
                            <td>
                                <a class="btn btn-danger" role="button" *ngIf="selectedStandardID==rowData.idStandard"
                                    data-toggle="tooltip" data-placement="top" title="supprimer" data-toggle="modal"
                                    data-target="#confirmationModal">
                                    <i class="far fa-times-circle" style="font-size: 1.2em;"></i>
                                </a>
                                <a class="btn btn-danger" role="button" *ngIf="selectedStandardID!=rowData.idStandard"
                                    disabled>
                                    <i class="far fa-times-circle" style="font-size: 0.8em;" disabled></i>
                                </a>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>



                <!-- Modal dialog -->
                <p-dialog [(visible)]="afficherStd" header="{{selectedStandard?selectedStandard.titre:''}}"
                    [modal]="true" styleClass="p-fluid" [style]="{width: '70%'}">
                    <ng-template pTemplate="content">
                        <p-accordion [multiple]="true" [activeIndex]="[0]">
                            <p-accordionTab *ngFor="let etape of etapes" header="Etape {{etapes.indexOf(etape) +1}}">
                                <div class="col-sm-12 row border-bottom mx-auto text-muted" style="font-size: 14px;">
                                    <div class="col-sm-3 col my-2">
                                        <!-- photo -->
                                        <span *ngIf="isIMG(etape.fileLink)">
                                            <p-image *ngIf="etape.fileLink" class="mx-auto" [src]="etape.fileLink"
                                                alt="..." width="170" [preview]="true" class="shadow-4"></p-image>
                                            <p-image *ngIf="!(etape.fileLink)" class="mx-auto"
                                                src="../../assets/img/no-image.png" alt="..." width="170"
                                                [preview]="true" class="shadow-4"></p-image>
                                        </span>

                                        <!-- vidéo -->
                                        <span *ngIf="isVID(etape.fileLink)">
                                            <img src="../../assets/img/video.jpg" alt="..." style="width: 70%;"
                                                (click)="showDisplayVideoDialog(etape.fileLink,etape.description)">
                                        </span>

                                        <!-- no image and no vidéo -->
                                        <span *ngIf="!etape.fileLink">
                                            <img src="../../assets/img/no-image.png" alt="..." style="width: 70%;">
                                        </span>

                                    </div>

                                    <!-- titre | description | -->
                                    <div class="col-sm-5">
                                        <span class="font-weight-bolder">Description : </span><br />
                                        <p>{{etape.description}}</p>
                                    </div>
                                </div>
                            </p-accordionTab>
                        </p-accordion>
                    </ng-template>

                    <!-- cancel -->
                    <ng-template pTemplate="footer">
                        <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
                            (click)="fermerStandard()"></button>
                    </ng-template>
                </p-dialog>


                <!-- affichage de la vidéo -->
                <p-dialog header="" [(visible)]="isDisplayVideoVisible" [style]="{width: '50vw'}">
                    <video class="w-100" controls autoplay>
                        <source [src]="videoFileLink" type="video/mp4">
                    </video>
                    <p class="text-muted">{{videoDescription}}</p>
                </p-dialog>
            </div>
        </div>
    </div>
</div>


<!-- Confirmation Modal -->
<div *ngIf="selectedStandard" class="modal fade" id="confirmationModal" tabindex="-1" role="dialog"
    aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">

                <h5 class="modal-title d-flex justify-content-around align-items-center" id="exampleModalLabel"> <span
                        style="color: #df4759;"><i class="fas fa-exclamation-circle mx-2"></i></span>Demande de
                    confirmation</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Confirmer la suppression du standard : {{selectedStandard.titre}}?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" data-dismiss="modal">Annuler</button>
                <button type="button" (click)=deleteStandard() class="btn btn-danger" data-dismiss="modal">Oui,
                    supprimer</button>
            </div>
        </div>
    </div>
</div>