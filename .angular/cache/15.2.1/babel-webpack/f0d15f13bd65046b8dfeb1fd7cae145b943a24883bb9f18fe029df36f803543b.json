{"ast":null,"code":"import { __awaiter, __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { MessageService, ConfirmationService } from 'primeng/api';\nlet StandardAjouterComponent = class StandardAjouterComponent {\n  constructor(zoneService, standardService, formBuilder, confirmationService, messageService) {\n    this.zoneService = zoneService;\n    this.standardService = standardService;\n    this.formBuilder = formBuilder;\n    this.confirmationService = confirmationService;\n    this.messageService = messageService;\n    this.isTitleVisible = false;\n    this.isStepListVisible = false;\n    this.isSaveButtonVisible = false;\n    this.titre = \"\";\n    this.toBase64 = file => new Promise((resolve, reject) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file);\n      reader.onload = () => resolve(reader.result);\n      reader.onerror = error => reject(error);\n    });\n  }\n  ngOnInit() {\n    this.getZones();\n    this.initForm();\n    this.products = [{\n      description: 'utiliser le pied de biche',\n      image: 'lien img (lien http?)',\n      id: ''\n    }];\n  }\n  getZones() {\n    this.zoneService.getAllZones().subscribe(data => {\n      this.zones = data;\n    });\n  }\n  initForm() {\n    this.formStd = this.formBuilder.group({\n      titre: '',\n      date: '',\n      lien: '',\n      zone: this.formBuilder.group({\n        idZone: ''\n      })\n    });\n  }\n  onUpload(event) {\n    console.log(event);\n    this.uploadedFile = event.target.value;\n    var image = document.getElementById('output');\n    image.src = URL.createObjectURL(event.target.files[0]);\n  }\n  fileChange(event) {\n    return __awaiter(this, void 0, void 0, function* () {\n      this.uploadedFile = event.target.value;\n      this.base64File = yield this.toBase64(event.target.files[0]);\n      this.formStd.get('lien').setValue(this.base64File);\n      //this.step += 1\n    });\n  }\n\n  sauvegarder() {\n    this.standardService.saveStandard(this.formStd.value).subscribe(() => {\n      //this.step = 0\n      this.uploadedFile = \"\";\n      this.formStd.reset();\n    });\n  }\n  annuler() {\n    //this.step = 0\n    this.isTitleVisible = false;\n    this.isStepListVisible = false;\n    this.uploadedFile = \"\";\n    this.titre = \"\";\n    this.formStd.reset();\n  }\n  ajouter() {\n    //this.step = 1\n    this.isTitleVisible = true;\n  }\n  titleChange(val) {\n    this.titre = val;\n    this.formStd.get('titre').setValue(val);\n  }\n  zoneChange(val) {\n    this.formStd.get('zone.idZone').setValue(val);\n    this.isStepListVisible = true;\n    //this.step = 2\n  }\n\n  openNew() {\n    this.product = {};\n    this.submitted = false;\n    this.productDialog = true;\n  }\n  deleteSelectedProducts() {\n    this.confirmationService.confirm({\n      message: 'Êtes-vous sûr de vouloir supprimer cette étape ?',\n      header: 'Confirm',\n      icon: 'pi pi-exclamation-triangle',\n      accept: () => {\n        this.products = this.products.filter(val => !this.selectedProducts.includes(val));\n        this.selectedProducts = null;\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Products Deleted',\n          life: 3000\n        });\n      }\n    });\n  }\n  editProduct(product) {\n    this.product = Object.assign({}, product);\n    this.productDialog = true;\n  }\n  deleteProduct(product) {\n    this.confirmationService.confirm({\n      message: \"Êtes-vous sûr de vouloir supprimer l'étape : \" + product.description + \"?\",\n      header: 'Confirm',\n      icon: 'pi pi-exclamation-triangle',\n      accept: () => {\n        this.products = this.products.filter(val => val.id !== product.id);\n        this.product = {};\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Product Deleted',\n          life: 3000\n        });\n      }\n    });\n  }\n  hideDialog() {\n    this.productDialog = false;\n    this.submitted = false;\n  }\n  saveProduct() {\n    this.submitted = true;\n    if (this.product.description.trim()) {\n      if (this.product.id) {\n        this.products[this.findIndexById(this.product.id)] = this.product;\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Product Updated',\n          life: 3000\n        });\n      } else {\n        this.product.id = this.createId();\n        this.product.image = 'product-placeholder.svg';\n        this.products.push(this.product);\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Product Created',\n          life: 3000\n        });\n      }\n      this.products = [...this.products];\n      this.productDialog = false;\n      this.product = {};\n    }\n  }\n  findIndexById(id) {\n    let index = -1;\n    for (let i = 0; i < this.products.length; i++) {\n      if (this.products[i].id === id) {\n        index = i;\n        break;\n      }\n    }\n    return index;\n  }\n  createId() {\n    let id = '';\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n    for (var i = 0; i < 5; i++) {\n      id += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return id;\n  }\n};\nStandardAjouterComponent = __decorate([Component({\n  selector: 'app-standard-ajouter',\n  templateUrl: './standard-ajouter.component.html',\n  styleUrls: ['./standard-ajouter.component.scss'],\n  styles: [`\n  :host ::ng-deep .p-dialog .product-image {\n      width: 150px;\n      margin: 0 auto 2rem auto;\n      display: block;\n  }\n`],\n  providers: [MessageService, ConfirmationService]\n})], StandardAjouterComponent);\nexport { StandardAjouterComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}